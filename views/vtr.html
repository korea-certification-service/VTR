<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Document</title>
<link href="/css/vtr.css" rel="stylesheet">
<script src="/socket.io.js"></script>
<script src="/js/jquery.min.js"></script>
</head>
<body>
    <div class="chat_wrap" id="chatWrap">
        <header class="header">
            <h1>세라핌 클레압 팝니다</h1>
        </header>
        <div class="content" id="content">
            <!--
            <em class="other_id">other</em>
            <div class="bubble other_speech"><p>안녕하세요 &#128513;</p></div>
            <div class="bubble other_speech">
                <p>
                    거래 요청 드립니다
                    <span class="chat_time">오전 1:47</span>
                </p>
            </div>
            <em class="my_id">imymemine</em>
            <div class="bubble my_speech"><p>넹 &#128513;</p></div>
            <div class="bubble my_speech">
                <p>
                    말씀하세요.말씀하세요.말씀하세요.말씀하세요.말씀하세요.말씀하세요.말씀하세요.말씀하세요.말씀하세요.말씀하세요.
                    <span class="chat_time">오후 11:07</span>
                </p>
            </div>
            <div class="ymd">2019년 6월 14일</div>
            <em class="mach_id">chatbot</em>
            <div class="bubble mach_speech"><p>거래 진행은 판매자만 가능합니다.거래 진행은 판매자만 가능합니다.거래 진행은 판매자만 가능합니다.거래 진행은 판매자만 가능합니다.</p></div>
            <div class="chat_dim" id="chatDim"></div>
            <em class="other_id">other</em>
            <div class="bubble other_speech"><p>안녕하세요 &#128513;</p></div>
            <div class="bubble other_speech"><p>거래 요청 드립니다</p></div>
            <em class="my_id">imymemine</em>
            <div class="bubble my_speech"><p>넹 &#128513;</p></div>
            <div class="bubble my_speech"><p>말씀하세요</p></div>
            <div class="ymd">2019년 6월 14일</div>
            <em class="mach_id">chatbot</em>
            <div class="bubble mach_speech"><p>거래 진행은 판매자만 가능합니다.</p></div>
            -->
            <div class="chat_dim" id="chatDim"></div>
        </div>
        <footer class="footer cf">
            <div class="msg_sec cf">
                <button class="btn_at" id="btnAt"><img src="/img/ico_@.png" alt="@"></button>
                <input type="text" class="ipt_chat" id="iptChat" placeholder="메세지를 입력하세요.">
                <button class="btn_send">Send</button>
            </div>
            <!-- <div class="util_sec cf">
                <button class="btn_sharp">#</button>
                <button class="btn_emoji">&#128513;</button>
            </div> -->
            <div class="at_sec" id="atSec">
                <div class="mach_command machCmd">@마하 거래시작</div>
                <div class="mach_command machCmd">@마하 거래안내</div>
                <div class="mach_command machCmd">@마하 거래중단</div>
                <div class="mach_command machCmd">@마하 거래흥정</div>
                <div class="mach_command machCmd">@마하 거래시작</div>
                <div class="mach_command machCmd">@마하 거래안내</div>
                <div class="mach_command machCmd">@마하 거래중단</div>
                <div class="mach_command machCmd">@마하 거래흥정</div>
            </div>
        </footer>
    </div>
<script>
var serverURL = 'http://localhost:4000';
var socket = io.connect(serverURL, { transports: ['websocket'] }); // polling 사용 안함

var chatUI = {
    isDim: false,
    init: function() {
        this.fnAt();
        this.orientationchange();
        this.sendMsg();
    },
    fnAt: function() {
        var that = this;

        function hideDim() {
            that.isDim = false;
            document.getElementById("atSec").style.display="none";
            document.getElementById("chatDim").style.display="none";  
        }

        function showDim() {
            that.isDim = true;
            document.getElementById("atSec").style.display="block";
            document.getElementById("chatDim").style.display="block";
        }
        
        document.getElementById("btnAt").addEventListener("click", function(){
            showDim();
        });

        document.getElementById("chatWrap").addEventListener("click", function(e){
            if(e.target.id === "chatDim" && that.isDim){
                hideDim();
            }
        });

        var machCmd = document.querySelectorAll(".at_sec .machCmd");
        var iptChat = document.getElementById("iptChat");
        for (var i = 0; i < machCmd.length; i++) {
            machCmd[i].addEventListener("click", function(e){
                //console.log(e.target.innerText);
                iptChat.value = "";
                iptChat.value = e.target.innerText;
                hideDim();
                // 여기서 메세지 입력되면 됨
            });
        }
    },
    orientationchange: function() {
        window.addEventListener("orientationchange", function() {
            // window.orientation: 90 가로, 0 세로
            document.getElementById("content").addEventListener("click", function(){
                document.getElementById("chatDim").focus();
            });
        });        
    },
    sendMsg: function() {

    }
}    
chatUI.init();
</script>    
</body>
</html>